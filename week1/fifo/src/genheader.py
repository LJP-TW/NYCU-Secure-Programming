#!/usr/bin/env python3

shellcode = [0x48, 0x89, 0xE5, 0xB8, 0x29, 0x00, 0x00, 0x00, 0xBF, 0x02, 0x00, 0x00, 0x00, 0xBE, 0x02, 0x00, 0x00, 0x00, 0xBA, 0x11, 0x00, 0x00, 0x00, 0x0F, 0x05, 0x89, 0x45, 0xF8, 0x48, 0x89, 0xC7, 0xB8, 0x36, 0x00, 0x00, 0x00, 0xBE, 0x01, 0x00, 0x00, 0x00, 0xBA, 0x06, 0x00, 0x00, 0x00, 0x4C, 0x8D, 0x55, 0xF0, 0xC7, 0x45, 0xF0, 0x01, 0x00, 0x00, 0x00, 0x41, 0xB8, 0x04, 0x00, 0x00, 0x00, 0x0F, 0x05] 

with open('hw1r', 'rb') as f:
    hw1r = f.read()

enc_hw1r = []
sidx = 0
for idx in range(len(hw1r)):
    t = hw1r[idx]
    t ^= shellcode[(sidx + 0) % len(shellcode)]
    t ^= shellcode[(sidx + 1) % len(shellcode)]
    t ^= shellcode[(sidx + 2) % len(shellcode)]
    t ^= shellcode[(sidx + 3) % len(shellcode)]
    sidx += 4
    enc_hw1r.append(t)

with open('enc_payload.h', 'wb+') as f:
    f.write(b'char payload_hw1r[] = {')
    for b in enc_hw1r:
        f.write(f'{int(b)}, '.encode())
    f.write(b'};\n')
    f.write(f'int payload_hw1r_len = {len(hw1r)};\n'.encode())
